// Generated by CoffeeScript 1.7.1
(function() {
  define(["corejs"], function(Core) {
    return Core.register("dispatcher", function(sandbox) {
      return {
        init: function() {
          var self;
          console.log("Starting dispatcher...");
          self = this;
          return sandbox.use("$").get("javascripts/config.json", function(config) {
            var db_time;
            self.config = config;
            sandbox.notify({
              type: "config-data",
              data: {
                config: self.config
              }
            });
            sandbox.notify({
              type: "db-setup",
              data: {
                name: self.config.db
              }
            });
            db_time = function() {
              return sandbox.notify({
                type: "db-act",
                data: {
                  mode: "push",
                  location: "time",
                  info: {
                    now: Date.now()
                  }
                }
              });
            };
            return self.delay(db_time, 1000);
          });
        },
        delay: function(func, time) {
          return setTimeout(func, time);
        },
        destroy: function() {
          return console.log("Stopping dispatcher...");
        }
      };
    });
  });

}).call(this);
